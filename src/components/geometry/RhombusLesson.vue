<template>
  <div class="rhombus-lesson">
    <div class="lesson-content">
      <!-- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è -->
      <section class="content-section">
        <h2>üîç –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è</h2>
        <div class="definition-box">
          <p><strong>–†–æ–º–±</strong> ‚Äî —Ü–µ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º, —É —è–∫–æ–≥–æ –≤—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ä—ñ–≤–Ω—ñ.</p>
          <div class="rhombus-visual">
            <canvas ref="definitionCanvas" width="300" height="200"></canvas>
          </div>
        </div>
      </section>

      <!-- –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ -->
      <section class="content-section">
        <h2>‚≠ê –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ä–æ–º–±–∞</h2>
        <div class="properties-info">
          <p class="properties-note">–û—Å–∫—ñ–ª—å–∫–∏ —Ä–æ–º–± —î –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–æ–º, –≤—ñ–Ω –º–∞—î –≤—Å—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞, –∞ —Ç–∞–∫–æ–∂ –æ—Å–æ–±–ª–∏–≤—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:</p>
        </div>

        <div class="properties-grid">
          <div class="property-card" @click="highlightProperty('sides')">
            <h3>üìè –°—Ç–æ—Ä–æ–Ω–∏</h3>
            <p>–í—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ä–æ–º–±–∞ —Ä—ñ–≤–Ω—ñ</p>
            <div class="formula">AB = BC = CD = AD</div>
          </div>

          <div class="property-card" @click="highlightProperty('angles')">
            <h3>üìê –ö—É—Ç–∏</h3>
            <p>–ü—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ –∫—É—Ç–∏ —Ä–æ–º–±–∞ —Ä—ñ–≤–Ω—ñ</p>
            <div class="formula">‚à†A = ‚à†C, ‚à†B = ‚à†D</div>
          </div>

          <div class="property-card" @click="highlightProperty('diagonals-perpendicular')">
            <h3>‚ä• –î—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ</h3>
            <p>–î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä–æ–º–±–∞ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ</p>
            <div class="formula">AC ‚ä• BD</div>
          </div>

          <div class="property-card" @click="highlightProperty('diagonals-bisect')">
            <h3>üìç –î—ñ–∞–≥–æ–Ω–∞–ª—ñ –¥—ñ–ª—è—Ç—å—Å—è –Ω–∞–≤–ø—ñ–ª</h3>
            <p>–î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ç–æ—á–∫–æ—é –ø–µ—Ä–µ—Ç–∏–Ω—É –¥—ñ–ª—è—Ç—å—Å—è –Ω–∞–≤–ø—ñ–ª</p>
            <div class="formula">AO = OC, BO = OD</div>
          </div>

          <div class="property-card" @click="highlightProperty('angle-bisectors')">
            <h3>üîÑ –ë—ñ—Å–µ–∫—Ç—Ä–∏—Å–∏ –∫—É—Ç—ñ–≤</h3>
            <p>–î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä–æ–º–±–∞ —î –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–∞–º–∏ –π–æ–≥–æ –∫—É—Ç—ñ–≤</p>
            <div class="formula">‚à†BAC = ‚à†CAD</div>
          </div>

          <div class="property-card" @click="highlightProperty('heights')">
            <h3>üìè –í–∏—Å–æ—Ç–∏</h3>
            <p>–í—Å—ñ –≤–∏—Å–æ—Ç–∏ —Ä–æ–º–±–∞ —Ä—ñ–≤–Ω—ñ</p>
            <div class="formula">h‚ÇÅ = h‚ÇÇ = h‚ÇÉ = h‚ÇÑ</div>
          </div>
        </div>

        <div class="interactive-rhombus">
          <canvas ref="propertiesCanvas" width="400" height="300"></canvas>
          <p class="hint">üí° –ö–ª—ñ–∫–Ω–∏ –Ω–∞ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≤–∏—â–µ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —ó—Ö –Ω–∞ –º–∞–ª—é–Ω–∫—É!</p>
        </div>
      </section>

      <!-- –¢–µ–æ—Ä–µ–º–∞ –ø—Ä–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ -->
      <section class="content-section">
        <h2>üìñ –¢–µ–æ—Ä–µ–º–∞ 5.1</h2>
        <div class="theorem-box">
          <p><strong>–¢–µ–æ—Ä–µ–º–∞:</strong> –î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä–æ–º–±–∞ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ —ñ —î –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–∞–º–∏ –π–æ–≥–æ –∫—É—Ç—ñ–≤.</p>
          <div class="proof-section">
            <h4>–î–æ–≤–µ–¥–µ–Ω–Ω—è:</h4>
            <p>–¢—Ä–∏–∫—É—Ç–Ω–∏–∫ ABC (—É—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–≤–æ–º–∞ —Å—É—Å—ñ–¥–Ω—ñ–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ —Ä–æ–º–±–∞ —ñ –¥—ñ–∞–≥–æ–Ω–∞–ª–ª—é) —î —Ä—ñ–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–∏–º, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ä–æ–º–±–∞ —Ä—ñ–≤–Ω—ñ.</p>
            <p>–í—ñ–¥—Ä—ñ–∑–æ–∫ BO (—á–∞—Å—Ç–∏–Ω–∞ –¥—Ä—É–≥–æ—ó –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ) —î –º–µ–¥—ñ–∞–Ω–æ—é —Ü—å–æ–≥–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞, –∞ –æ—Ç–∂–µ ‚Äî —ñ –π–æ–≥–æ –≤–∏—Å–æ—Ç–æ—é —Ç–∞ –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–æ—é.</p>
            <canvas ref="theoremCanvas" width="350" height="250"></canvas>
          </div>
        </div>
      </section>

      <!-- –û–∑–Ω–∞–∫–∏ -->
      <section class="content-section">
        <h2>‚úÖ –û–∑–Ω–∞–∫–∏ —Ä–æ–º–±–∞</h2>
        <p class="intro-text">–û–∑–Ω–∞–∫–∏ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —á–∏ —î –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º —Ä–æ–º–±–æ–º:</p>

        <div class="signs-list">
          <div class="sign-item theorem">
            <div class="sign-number">üìñ</div>
            <div class="sign-content">
              <h4>–¢–µ–æ—Ä–µ–º–∞ 5.2</h4>
              <p>–Ø–∫—â–æ –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ, —Ç–æ —Ü–µ–π –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º ‚Äî —Ä–æ–º–±</p>
            </div>
          </div>

          <div class="sign-item theorem">
            <div class="sign-number">üìñ</div>
            <div class="sign-content">
              <h4>–¢–µ–æ—Ä–µ–º–∞ 5.3</h4>
              <p>–Ø–∫—â–æ –¥—ñ–∞–≥–æ–Ω–∞–ª—å –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ —î –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–æ—é –π–æ–≥–æ –∫—É—Ç–∞, —Ç–æ —Ü–µ–π –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º ‚Äî —Ä–æ–º–±</p>
            </div>
          </div>

          <div class="sign-item">
            <div class="sign-number">1Ô∏è‚É£</div>
            <div class="sign-content">
              <p>–Ø–∫—â–æ –¥–≤—ñ —Å—É—Å—ñ–¥–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ —Ä—ñ–≤–Ω—ñ, —Ç–æ –≤—ñ–Ω —î —Ä–æ–º–±–æ–º</p>
            </div>
          </div>

          <div class="sign-item">
            <div class="sign-number">2Ô∏è‚É£</div>
            <div class="sign-content">
              <p>–ß–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏–∫, —É—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —è–∫–æ–≥–æ —Ä—ñ–≤–Ω—ñ, —î —Ä–æ–º–±–æ–º</p>
            </div>
          </div>
        </div>
      </section>

      <!-- –ó–≤'—è–∑–æ–∫ –∑ —ñ–Ω—à–∏–º–∏ —Ñ—ñ–≥—É—Ä–∞–º–∏ -->
      <section class="content-section">
        <h2>üîó –ó–≤'—è–∑–æ–∫ –∑ —ñ–Ω—à–∏–º–∏ —Ñ—ñ–≥—É—Ä–∞–º–∏</h2>
        <div class="relationships-grid">
          <div class="relationship-card">
            <h3>‚óæ –ö–≤–∞–¥—Ä–∞—Ç</h3>
            <p>–ö–≤–∞–¥—Ä–∞—Ç ‚Äî —Ü–µ –æ–∫—Ä–µ–º–∏–π –≤–∏–¥ —Ä–æ–º–±–∞ (—Ä–æ–º–± —ñ–∑ —É—Å—ñ–º–∞ –∫—É—Ç–∞–º–∏ –ø—Ä—è–º–∏–º–∏)</p>
            <canvas ref="squareCanvas" width="150" height="100"></canvas>
            <div class="relationship-note">
              <p><strong>–ü—Ä–∞–≤–∏–ª–æ:</strong> –Ø–∫—â–æ –æ–¥–∏–Ω —ñ–∑ –∫—É—Ç—ñ–≤ —Ä–æ–º–±–∞ –ø—Ä—è–º–∏–π, —Ç–æ —Ü–µ–π —Ä–æ–º–± —î –∫–≤–∞–¥—Ä–∞—Ç–æ–º</p>
            </div>
          </div>

          <div class="relationship-card">
            <h3>üîÑ –í–ø–∏—Å–∞–Ω–µ –∫–æ–ª–æ</h3>
            <p>–£ –±—É–¥—å-—è–∫–∏–π —Ä–æ–º–± –º–æ–∂–Ω–∞ –≤–ø–∏—Å–∞—Ç–∏ –∫–æ–ª–æ</p>
            <canvas ref="inscribedCircleCanvas" width="150" height="100"></canvas>
          </div>

          <div class="relationship-card">
            <h3>üö´ –û–ø–∏—Å–∞–Ω–µ –∫–æ–ª–æ</h3>
            <p>–ù–∞–≤–∫–æ–ª–æ —Ä–æ–º–±–∞ (—è–∫–∏–π –Ω–µ —î –∫–≤–∞–¥—Ä–∞—Ç–æ–º) –Ω–µ –º–æ–∂–Ω–∞ –æ–ø–∏—Å–∞—Ç–∏ –∫–æ–ª–æ</p>
            <canvas ref="circumscribedCanvas" width="150" height="100"></canvas>
          </div>
        </div>
      </section>

      <!-- –ü—ñ–¥—Å—É–º–æ–∫ -->
      <section class="content-section summary">
        <h2>üìù –ü—ñ–¥—Å—É–º–æ–∫</h2>
        <div class="summary-box">
          <p><strong>–ó–∞–ø–∞–º'—è—Ç–∞–π:</strong></p>
          <ul>
            <li>üî∏ –†–æ–º–± ‚Äî –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º –∑ —É—Å—ñ–º–∞ —Ä—ñ–≤–Ω–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏</li>
            <li>üî∏ –î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä–æ–º–±–∞ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ —ñ —î –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–∞–º–∏ –∫—É—Ç—ñ–≤</li>
            <li>üî∏ –í—Å—ñ –≤–∏—Å–æ—Ç–∏ —Ä–æ–º–±–∞ —Ä—ñ–≤–Ω—ñ</li>
            <li>üî∏ –ö–≤–∞–¥—Ä–∞—Ç ‚Äî —Ü–µ –æ–∫—Ä–µ–º–∏–π –≤–∏–¥ —Ä–æ–º–±–∞</li>
            <li>üî∏ –£ —Ä–æ–º–± –º–æ–∂–Ω–∞ –≤–ø–∏—Å–∞—Ç–∏ –∫–æ–ª–æ</li>
          </ul>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, nextTick } from 'vue'

const definitionCanvas = ref(null)
const propertiesCanvas = ref(null)
const theoremCanvas = ref(null)
const squareCanvas = ref(null)
const inscribedCircleCanvas = ref(null)
const circumscribedCanvas = ref(null)

const currentHighlight = ref('')

function drawRhombus(canvas, options = {}) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)
  ctx.strokeStyle = options.strokeColor || '#7c3aed'
  ctx.fillStyle = options.fillColor || 'rgba(124, 58, 237, 0.1)'
  ctx.lineWidth = options.lineWidth || 2

  const centerX = width / 2
  const centerY = height / 2
  const w = options.width || 60
  const h = options.height || 40

  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–µ—Ä—à–∏–Ω —Ä–æ–º–±–∞
  const points = [
    [centerX, centerY - h], // A (–≤–µ—Ä—Ö)
    [centerX + w, centerY], // B (–ø—Ä–∞–≤–æ)
    [centerX, centerY + h], // C (–Ω–∏–∑)
    [centerX - w, centerY]  // D (–ª—ñ–≤–æ)
  ]

  // –ú–∞–ª—é—î–º–æ —Ä–æ–º–±
  ctx.beginPath()
  ctx.moveTo(points[0][0], points[0][1])
  for (let i = 1; i < points.length; i++) {
    ctx.lineTo(points[i][0], points[i][1])
  }
  ctx.closePath()
  ctx.fill()
  ctx.stroke()

  // –ü—ñ–¥–ø–∏—Å–∏ –≤–µ—Ä—à–∏–Ω
  if (options.showLabels !== false) {
    ctx.fillStyle = '#1f2937'
    ctx.font = '14px Arial'
    ctx.fillText('A', points[0][0] - 8, points[0][1] - 10)
    ctx.fillText('B', points[1][0] + 10, points[1][1] + 5)
    ctx.fillText('C', points[2][0] - 8, points[2][1] + 20)
    ctx.fillText('D', points[3][0] - 20, points[3][1] + 5)
  }

  return points
}

function drawRhombusWithProperties(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const points = drawRhombus(canvas, {
    width: 80,
    height: 60,
    strokeColor: '#7c3aed',
    fillColor: 'rgba(124, 58, 237, 0.1)'
  })

  const centerX = (points[0][0] + points[2][0]) / 2
  const centerY = (points[0][1] + points[2][1]) / 2

  // –í–∏–¥—ñ–ª—è—î–º–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤–∏–±–æ—Ä—É
  if (currentHighlight.value === 'sides') {
    // –í–∏–¥—ñ–ª—è—î–º–æ –≤—Å—ñ —Å—Ç–æ—Ä–æ–Ω–∏
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 4

    for (let i = 0; i < 4; i++) {
      ctx.beginPath()
      ctx.moveTo(points[i][0], points[i][1])
      ctx.lineTo(points[(i + 1) % 4][0], points[(i + 1) % 4][1])
      ctx.stroke()
    }

    // –ü–æ–∑–Ω–∞—á–∫–∏ —Ä—ñ–≤–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω
    ctx.fillStyle = '#dc2626'
    for (let i = 0; i < 4; i++) {
      const x1 = points[i][0]
      const y1 = points[i][1]
      const x2 = points[(i + 1) % 4][0]
      const y2 = points[(i + 1) % 4][1]

      const midX = (x1 + x2) / 2
      const midY = (y1 + y2) / 2

      ctx.beginPath()
      ctx.arc(midX, midY, 3, 0, 2 * Math.PI)
      ctx.fill()
    }

  } else if (currentHighlight.value === 'angles') {
    // –ü–æ–∑–Ω–∞—á–∞—î–º–æ –∫—É—Ç–∏
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 2

    // –ú–∞–ª—é—î–º–æ –¥—É–≥–∏ –¥–ª—è –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–∏—Ö –∫—É—Ç—ñ–≤
    drawAngleArc(ctx, points[0], points[3], points[1], 25)
    drawAngleArc(ctx, points[2], points[1], points[3], 25)

  } else if (currentHighlight.value === 'diagonals-perpendicular') {
    // –î—ñ–∞–≥–æ–Ω–∞–ª—ñ
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 3

    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[2][0], points[2][1])
    ctx.stroke()

    ctx.beginPath()
    ctx.moveTo(points[1][0], points[1][1])
    ctx.lineTo(points[3][0], points[3][1])
    ctx.stroke()

    // –ü–æ–∑–Ω–∞—á–∫–∞ –ø—Ä—è–º–æ–≥–æ –∫—É—Ç–∞
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 2
    const size = 15
    ctx.strokeRect(centerX - size/2, centerY - size/2, size, size)

  } else if (currentHighlight.value === 'diagonals-bisect') {
    // –î—ñ–∞–≥–æ–Ω–∞–ª—ñ –∑ —Ç–æ—á–∫–æ—é –ø–µ—Ä–µ—Ç–∏–Ω—É
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 3

    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[2][0], points[2][1])
    ctx.stroke()

    ctx.beginPath()
    ctx.moveTo(points[1][0], points[1][1])
    ctx.lineTo(points[3][0], points[3][1])
    ctx.stroke()

    // –¢–æ—á–∫–∞ –ø–µ—Ä–µ—Ç–∏–Ω—É
    ctx.fillStyle = '#dc2626'
    ctx.beginPath()
    ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI)
    ctx.fill()

    ctx.fillStyle = '#1f2937'
    ctx.font = '12px Arial'
    ctx.fillText('O', centerX + 8, centerY - 8)

  } else if (currentHighlight.value === 'angle-bisectors') {
    // –î—ñ–∞–≥–æ–Ω–∞–ª—ñ —è–∫ –±—ñ—Å–µ–∫—Ç—Ä–∏—Å–∏
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 3

    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[2][0], points[2][1])
    ctx.stroke()

    // –ü–æ–∑–Ω–∞—á–∞—î–º–æ —Ä—ñ–≤–Ω—ñ –∫—É—Ç–∏
    drawAngleArc(ctx, points[0], points[3], points[2], 20, '#dc2626')
    drawAngleArc(ctx, points[0], points[2], points[1], 20, '#dc2626')

  } else if (currentHighlight.value === 'heights') {
    // –í–∏—Å–æ—Ç–∏
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 2
    ctx.setLineDash([5, 5])

    // –í–∏—Å–æ—Ç–∞ –¥–æ –∫–æ–∂–Ω–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏
    const heights = [
      { from: [centerX, points[0][1]], to: [centerX, points[2][1]] },
      { from: [points[1][0], centerY], to: [points[3][0], centerY] }
    ]

    heights.forEach(h => {
      ctx.beginPath()
      ctx.moveTo(h.from[0], h.from[1])
      ctx.lineTo(h.to[0], h.to[1])
      ctx.stroke()
    })

    ctx.setLineDash([])
  }
}

function drawAngleArc(ctx, vertex, side1, side2, radius, color = '#dc2626') {
  const angle1 = Math.atan2(side1[1] - vertex[1], side1[0] - vertex[0])
  const angle2 = Math.atan2(side2[1] - vertex[1], side2[0] - vertex[0])

  ctx.strokeStyle = color
  ctx.beginPath()
  ctx.arc(vertex[0], vertex[1], radius, angle1, angle2)
  ctx.stroke()
}

function drawTheoremDemo(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const points = drawRhombus(canvas, {
    width: 70,
    height: 50,
    strokeColor: '#7c3aed'
  })

  const centerX = width / 2
  const centerY = height / 2

  // –í–∏–¥—ñ–ª—è—î–º–æ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ ABC
  ctx.fillStyle = 'rgba(220, 38, 38, 0.2)'
  ctx.beginPath()
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[1][0], points[1][1])
  ctx.lineTo(points[2][0], points[2][1])
  ctx.fill()

  // –î—ñ–∞–≥–æ–Ω–∞–ª—ñ
  ctx.strokeStyle = '#dc2626'
  ctx.lineWidth = 2

  ctx.beginPath()
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[2][0], points[2][1])
  ctx.stroke()

  ctx.beginPath()
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(centerX, centerY)
  ctx.stroke()

  // –ü–æ–∑–Ω–∞—á–∫–∞ –ø—Ä—è–º–æ–≥–æ –∫—É—Ç–∞
  const size = 12
  ctx.strokeRect(centerX - size/2, centerY - size/2, size, size)

  // –ü—ñ–¥–ø–∏—Å–∏
  ctx.fillStyle = '#1f2937'
  ctx.font = '12px Arial'
  ctx.fillText('O', centerX + 8, centerY - 8)
}

function drawSquare(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)
  ctx.strokeStyle = '#dc2626'
  ctx.fillStyle = 'rgba(220, 38, 38, 0.1)'
  ctx.lineWidth = 2

  const centerX = width / 2
  const centerY = height / 2
  const size = 50

  ctx.fillRect(centerX - size/2, centerY - size/2, size, size)
  ctx.strokeRect(centerX - size/2, centerY - size/2, size, size)

  // –ü–æ–∑–Ω–∞—á–∫–∏ –ø—Ä—è–º–∏—Ö –∫—É—Ç—ñ–≤
  const corner = 8
  ctx.strokeRect(centerX - size/2, centerY - size/2, corner, corner)
  ctx.strokeRect(centerX + size/2 - corner, centerY - size/2, corner, corner)
  ctx.strokeRect(centerX + size/2 - corner, centerY + size/2 - corner, corner, corner)
  ctx.strokeRect(centerX - size/2, centerY + size/2 - corner, corner, corner)
}

function drawInscribedCircle(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const points = drawRhombus(canvas, {
    width: 50,
    height: 35,
    showLabels: false
  })

  // –í–ø–∏—Å–∞–Ω–µ –∫–æ–ª–æ
  ctx.strokeStyle = '#10b981'
  ctx.fillStyle = 'rgba(16, 185, 129, 0.1)'
  ctx.lineWidth = 2

  const centerX = width / 2
  const centerY = height / 2
  const radius = 25

  ctx.beginPath()
  ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI)
  ctx.fill()
  ctx.stroke()
}

function drawCircumscribedDemo(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const points = drawRhombus(canvas, {
    width: 50,
    height: 35,
    showLabels: false
  })

  // –ü—É–Ω–∫—Ç–∏—Ä–Ω–µ –∫–æ–ª–æ –Ω–∞–≤–∫–æ–ª–æ (–Ω–µ–º–æ–∂–ª–∏–≤–µ)
  ctx.strokeStyle = '#ef4444'
  ctx.setLineDash([5, 5])
  ctx.lineWidth = 2

  const centerX = width / 2
  const centerY = height / 2
  const radius = 45

  ctx.beginPath()
  ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI)
  ctx.stroke()

  // –•—Ä–µ—Å—Ç–∏–∫ - –Ω–µ–º–æ–∂–ª–∏–≤–æ
  ctx.setLineDash([])
  ctx.lineWidth = 3
  ctx.beginPath()
  ctx.moveTo(centerX - 10, centerY - 10)
  ctx.lineTo(centerX + 10, centerY + 10)
  ctx.moveTo(centerX + 10, centerY - 10)
  ctx.lineTo(centerX - 10, centerY + 10)
  ctx.stroke()
}

function highlightProperty(property) {
  currentHighlight.value = property
  drawRhombusWithProperties(propertiesCanvas.value)
}

onMounted(async () => {
  await nextTick()

  if (definitionCanvas.value) {
    drawRhombus(definitionCanvas.value)
  }

  if (propertiesCanvas.value) {
    drawRhombusWithProperties(propertiesCanvas.value)
  }

  if (theoremCanvas.value) {
    drawTheoremDemo(theoremCanvas.value)
  }

  if (squareCanvas.value) {
    drawSquare(squareCanvas.value)
  }

  if (inscribedCircleCanvas.value) {
    drawInscribedCircle(inscribedCircleCanvas.value)
  }

  if (circumscribedCanvas.value) {
    drawCircumscribedDemo(circumscribedCanvas.value)
  }
})
</script>

<style scoped>
.rhombus-lesson {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  min-height: 100vh;
}

.lesson-content {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.content-section {
  background: white;
  padding: 2rem;
  border-radius: 15px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.08);
  border: 1px solid #e2e8f0;
}

.content-section h2 {
  color: #1e293b;
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  border-bottom: 3px solid #7c3aed;
  padding-bottom: 0.5rem;
}

.definition-box {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 2rem;
  align-items: center;
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 10px;
  border-left: 5px solid #7c3aed;
}

.definition-box p {
  font-size: 1.1rem;
  margin: 0;
  color: #334155;
}

.rhombus-visual {
  display: flex;
  justify-content: center;
  align-items: center;
}

.properties-info {
  margin-bottom: 1.5rem;
}

.properties-note {
  color: #475569;
  font-size: 1rem;
  margin: 0;
  font-style: italic;
}

.properties-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.property-card {
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 12px;
  border: 2px solid transparent;
  cursor: pointer;
  transition: all 0.3s ease;
}

.property-card:hover {
  border-color: #7c3aed;
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(124, 58, 237, 0.15);
}

.property-card h3 {
  color: #1e293b;
  margin: 0 0 1rem 0;
  font-size: 1.2rem;
}

.property-card p {
  color: #475569;
  margin: 0 0 0.5rem 0;
}

.formula {
  background: #ede9fe;
  padding: 0.5rem;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-weight: bold;
  color: #6d28d9;
  margin: 0.25rem 0;
}

.interactive-rhombus {
  text-align: center;
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 10px;
  border: 2px dashed #cbd5e1;
}

.hint {
  color: #64748b;
  font-style: italic;
  margin: 1rem 0 0 0;
}

.theorem-box {
  background: #fef3c7;
  padding: 1.5rem;
  border-radius: 10px;
  border-left: 5px solid #f59e0b;
}

.theorem-box p {
  color: #92400e;
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
}

.proof-section {
  margin-top: 1rem;
}

.proof-section h4 {
  color: #78350f;
  margin: 0 0 1rem 0;
}

.proof-section p {
  color: #78350f;
  margin: 0.5rem 0;
  font-size: 1rem;
}

.proof-section canvas {
  margin-top: 1rem;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.signs-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.sign-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  background: #f8fafc;
  padding: 1rem;
  border-radius: 10px;
  border-left: 4px solid #10b981;
}

.sign-item.theorem {
  border-left-color: #f59e0b;
  background: #fef3c7;
}

.sign-number {
  font-size: 1.5rem;
  min-width: 40px;
}

.sign-content p {
  margin: 0;
  color: #334155;
}

.sign-content h4 {
  margin: 0 0 0.5rem 0;
  color: #92400e;
  font-size: 1.1rem;
}

.intro-text {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.1rem;
}

.relationships-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.relationship-card {
  text-align: center;
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 12px;
  border: 2px solid #e2e8f0;
  transition: all 0.3s ease;
}

.relationship-card:hover {
  border-color: #7c3aed;
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.relationship-card h3 {
  color: #1e293b;
  margin: 0 0 0.5rem 0;
}

.relationship-card p {
  color: #64748b;
  margin: 0 0 1rem 0;
  font-size: 0.9rem;
}

.relationship-note {
  background: #fef3c7;
  padding: 1rem;
  border-radius: 8px;
  margin-top: 1rem;
}

.relationship-note p {
  color: #92400e;
  margin: 0;
  font-size: 0.9rem;
  font-weight: 500;
}

.summary {
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
  border: 2px solid #10b981;
}

.summary h2 {
  color: #047857;
  border-bottom-color: #10b981;
}

.summary-box {
  background: white;
  padding: 1.5rem;
  border-radius: 10px;
  border: 1px solid #a7f3d0;
}

.summary-box p {
  color: #047857;
  font-weight: bold;
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
}

.summary-box ul {
  color: #065f46;
  margin: 0;
  padding-left: 1.5rem;
}

.summary-box li {
  margin: 0.5rem 0;
  font-weight: 500;
}

canvas {
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  background: white;
}

@media (max-width: 768px) {
  .rhombus-lesson {
    padding: 1rem;
  }

  .definition-box {
    grid-template-columns: 1fr;
    text-align: center;
  }

  .properties-grid {
    grid-template-columns: 1fr;
  }

  .relationships-grid {
    grid-template-columns: 1fr;
  }
}
</style>