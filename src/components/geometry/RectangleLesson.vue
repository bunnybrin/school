<template>
  <div class="rectangle-lesson">
    <div class="lesson-content">
      <!-- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è -->
      <section class="content-section">
        <h2>üîç –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è</h2>
        <div class="definition-box">
          <p><strong>–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫</strong> ‚Äî —Ü–µ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º, —É —è–∫–æ–≥–æ –≤—Å—ñ –∫—É—Ç–∏ –ø—Ä—è–º—ñ.</p>
          <div class="rectangle-visual">
            <canvas ref="definitionCanvas" width="300" height="200"></canvas>
          </div>
        </div>
      </section>

      <!-- –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ -->
      <section class="content-section">
        <h2>‚≠ê –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞</h2>
        <p class="intro-text">–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ –º–∞—î –≤—Å—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ —Ç–∞ —Å–≤–æ—ó –æ—Å–æ–±–ª–∏–≤—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:</p>

        <div class="properties-grid">
          <div class="property-card" @click="highlightProperty('sides')">
            <h3>üìè –°—Ç–æ—Ä–æ–Ω–∏</h3>
            <p>–ü—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞ —Ä—ñ–≤–Ω—ñ</p>
            <div class="formula">AB = CD, BC = AD</div>
          </div>

          <div class="property-card" @click="highlightProperty('angles')">
            <h3>üìê –ö—É—Ç–∏</h3>
            <p>–í—Å—ñ –∫—É—Ç–∏ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞ –ø—Ä—è–º—ñ</p>
            <div class="formula">‚à†A = ‚à†B = ‚à†C = ‚à†D = 90¬∞</div>
          </div>

          <div class="property-card" @click="highlightProperty('diagonals')">
            <h3>üìç –î—ñ–∞–≥–æ–Ω–∞–ª—ñ</h3>
            <p>–î—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä—ñ–≤–Ω—ñ —Ç–∞ –¥—ñ–ª—è—Ç—å—Å—è –Ω–∞–≤–ø—ñ–ª —Ç–æ—á–∫–æ—é –ø–µ—Ä–µ—Ç–∏–Ω—É</p>
            <div class="formula">AC = BD, AO = OC = BO = OD</div>
          </div>

          <div class="property-card" @click="highlightProperty('center')">
            <h3>‚≠ï –¶–µ–Ω—Ç—Ä</h3>
            <p>–¢–æ—á–∫–∞ –ø–µ—Ä–µ—Ç–∏–Ω—É –¥—ñ–∞–≥–æ–Ω–∞–ª–µ–π —Ä—ñ–≤–Ω–æ–≤—ñ–¥–¥–∞–ª–µ–Ω–∞ –≤—ñ–¥ —É—Å—ñ—Ö –≤–µ—Ä—à–∏–Ω</p>
            <div class="formula">OA = OB = OC = OD</div>
          </div>
        </div>

        <div class="interactive-rectangle">
          <canvas ref="propertiesCanvas" width="400" height="300"></canvas>
          <p class="hint">üí° –ö–ª—ñ–∫–Ω–∏ –Ω–∞ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≤–∏—â–µ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —ó—Ö –Ω–∞ –º–∞–ª—é–Ω–∫—É!</p>
        </div>
      </section>

      <!-- –û–∑–Ω–∞–∫–∏ -->
      <section class="content-section">
        <h2>‚úÖ –û–∑–Ω–∞–∫–∏ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞</h2>
        <p class="intro-text">–û–∑–Ω–∞–∫–∏ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —á–∏ —î –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–æ–º:</p>

        <div class="signs-list">
          <div class="sign-item">
            <div class="sign-number">1Ô∏è‚É£</div>
            <div class="sign-content">
              <p><strong>–¢–µ–æ—Ä–µ–º–∞ 4.2:</strong> –Ø–∫—â–æ –æ–¥–∏–Ω —ñ–∑ –∫—É—Ç—ñ–≤ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ –ø—Ä—è–º–∏–π, —Ç–æ —Ü–µ–π –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º ‚Äî –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫</p>
            </div>
          </div>

          <div class="sign-item">
            <div class="sign-number">2Ô∏è‚É£</div>
            <div class="sign-content">
              <p><strong>–¢–µ–æ—Ä–µ–º–∞ 4.3:</strong> –Ø–∫—â–æ –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ —Ä—ñ–≤–Ω—ñ, —Ç–æ —Ü–µ–π –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º ‚Äî –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫</p>
            </div>
          </div>

          <div class="sign-item">
            <div class="sign-number">3Ô∏è‚É£</div>
            <div class="sign-content">
              <p>–Ø–∫—â–æ –≤ —á–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏–∫—É –≤—Å—ñ –∫—É—Ç–∏ –ø—Ä—è–º—ñ, —Ç–æ —Ü–µ–π —á–æ—Ç–∏—Ä–∏–∫—É—Ç–Ω–∏–∫ ‚Äî –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫</p>
            </div>
          </div>

          <div class="sign-item">
            <div class="sign-number">4Ô∏è‚É£</div>
            <div class="sign-content">
              <p>–Ø–∫—â–æ –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ —É—Ç–≤–æ—Ä—é—é—Ç—å —Ä—ñ–≤–Ω—ñ –∫—É—Ç–∏ –∑ –æ–¥–Ω—ñ—î—é –∑—ñ —Å—Ç–æ—Ä—ñ–Ω, —Ç–æ —Ü–µ–π –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º ‚Äî –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫</p>
            </div>
          </div>
        </div>
      </section>

      <!-- –ó–≤'—è–∑–æ–∫ –∑ —ñ–Ω—à–∏–º–∏ —Ñ—ñ–≥—É—Ä–∞–º–∏ -->
      <section class="content-section">
        <h2>üîó –ó–≤'—è–∑–æ–∫ –∑ —ñ–Ω—à–∏–º–∏ —Ñ—ñ–≥—É—Ä–∞–º–∏</h2>
        <div class="relationship-grid">
          <div class="relationship-card">
            <h3>üî∑ –ü–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º</h3>
            <p>–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ ‚Äî —Ü–µ –æ—Å–æ–±–ª–∏–≤–∏–π –≤–∏–ø–∞–¥–æ–∫ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞</p>
            <canvas ref="parallelogramCanvas" width="150" height="100"></canvas>
            <div class="formula">–í—Å—ñ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∏ —î –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞–º–∏</div>
          </div>

          <div class="relationship-card highlight">
            <h3>‚¨ú –ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫</h3>
            <p>–ü–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º –∑ —É—Å—ñ–º–∞ –ø—Ä—è–º–∏–º–∏ –∫—É—Ç–∞–º–∏</p>
            <canvas ref="rectangleCanvas" width="150" height="100"></canvas>
            <div class="formula">‚à† = 90¬∞, –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä—ñ–≤–Ω—ñ</div>
          </div>

          <div class="relationship-card">
            <h3>‚óæ –ö–≤–∞–¥—Ä–∞—Ç</h3>
            <p>–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ –∑ —É—Å—ñ–º–∞ —Ä—ñ–≤–Ω–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏</p>
            <canvas ref="squareCanvas" width="150" height="100"></canvas>
            <div class="formula">–í—Å—ñ –∫–≤–∞–¥—Ä–∞—Ç–∏ —î –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞–º–∏</div>
          </div>
        </div>

        <div class="special-property">
          <h3>üéØ –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å</h3>
          <p><strong>–Ø–∫—â–æ –≤ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ –º–æ–∂–Ω–∞ –≤–ø–∏—Å–∞—Ç–∏ –∫–æ–ª–æ, —Ç–æ —Ü–µ–π –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ —î –∫–≤–∞–¥—Ä–∞—Ç–æ–º.</strong></p>
          <canvas ref="inscribedCircleCanvas" width="300" height="200"></canvas>
        </div>
      </section>


      <!-- –ü—ñ–¥—Å—É–º–æ–∫ -->
      <section class="content-section summary">
        <h2>üìù –ü—ñ–¥—Å—É–º–æ–∫</h2>
        <div class="summary-box">
          <p><strong>–ó–∞–ø–∞–º'—è—Ç–∞–π:</strong></p>
          <ul>
            <li>üî∏ –ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ ‚Äî –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º –∑ —É—Å—ñ–º–∞ –ø—Ä—è–º–∏–º–∏ –∫—É—Ç–∞–º–∏</li>
            <li>üî∏ –£—Å—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞ + –¥—ñ–∞–≥–æ–Ω–∞–ª—ñ —Ä—ñ–≤–Ω—ñ</li>
            <li>üî∏ –¢–æ—á–∫–∞ –ø–µ—Ä–µ—Ç–∏–Ω—É –¥—ñ–∞–≥–æ–Ω–∞–ª–µ–π ‚Äî —Ü–µ–Ω—Ç—Ä –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞</li>
            <li>üî∏ –ö–≤–∞–¥—Ä–∞—Ç ‚Äî –æ–∫—Ä–µ–º–∏–π –≤–∏–ø–∞–¥–æ–∫ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞</li>
          </ul>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, nextTick } from 'vue'

const definitionCanvas = ref(null)
const propertiesCanvas = ref(null)
const parallelogramCanvas = ref(null)
const rectangleCanvas = ref(null)
const squareCanvas = ref(null)
const inscribedCircleCanvas = ref(null)
const medianCanvas = ref(null)

const currentHighlight = ref('')

function drawRectangle(canvas, options = {}) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)
  ctx.strokeStyle = options.strokeColor || '#2563eb'
  ctx.fillStyle = options.fillColor || 'rgba(37, 99, 235, 0.1)'
  ctx.lineWidth = 2

  const centerX = width / 2
  const centerY = height / 2
  const w = options.width || 100
  const h = options.height || 60

  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–µ—Ä—à–∏–Ω
  const points = [
    [centerX - w/2, centerY - h/2], // A
    [centerX + w/2, centerY - h/2], // B
    [centerX + w/2, centerY + h/2], // C
    [centerX - w/2, centerY + h/2]  // D
  ]

  // –ú–∞–ª—é—î–º–æ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫
  ctx.beginPath()
  ctx.rect(centerX - w/2, centerY - h/2, w, h)
  ctx.fill()
  ctx.stroke()

  // –ü—ñ–¥–ø–∏—Å–∏ –≤–µ—Ä—à–∏–Ω
  if (!options.hideLabels) {
    ctx.fillStyle = '#1f2937'
    ctx.font = '14px Arial'
    ctx.fillText('A', points[0][0] - 15, points[0][1] - 5)
    ctx.fillText('B', points[1][0] + 5, points[1][1] - 5)
    ctx.fillText('C', points[2][0] + 5, points[2][1] + 15)
    ctx.fillText('D', points[3][0] - 15, points[3][1] + 15)
  }

  // –ü–æ–∑–Ω–∞—á–∫–∏ –ø—Ä—è–º–∏—Ö –∫—É—Ç—ñ–≤
  if (options.showRightAngles) {
    ctx.strokeStyle = options.strokeColor || '#2563eb'
    const corner = 8
    ctx.strokeRect(points[0][0], points[0][1], corner, corner)
    ctx.strokeRect(points[1][0] - corner, points[1][1], corner, corner)
    ctx.strokeRect(points[2][0] - corner, points[2][1] - corner, corner, corner)
    ctx.strokeRect(points[3][0], points[3][1] - corner, corner, corner)
  }

  return points
}

function drawRectangleWithProperties(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const points = drawRectangle(canvas, {
    width: 140,
    height: 90,
    strokeColor: '#2563eb',
    fillColor: 'rgba(37, 99, 235, 0.1)',
    showRightAngles: true
  })

  // –í–∏–¥—ñ–ª—è—î–º–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤–∏–±–æ—Ä—É
  if (currentHighlight.value === 'sides') {
    // –í–∏–¥—ñ–ª—è—î–º–æ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 4

    // AB —Ç–∞ CD
    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[1][0], points[1][1])
    ctx.stroke()

    ctx.beginPath()
    ctx.moveTo(points[2][0], points[2][1])
    ctx.lineTo(points[3][0], points[3][1])
    ctx.stroke()

    // BC —Ç–∞ AD
    ctx.strokeStyle = '#16a34a'
    ctx.beginPath()
    ctx.moveTo(points[1][0], points[1][1])
    ctx.lineTo(points[2][0], points[2][1])
    ctx.stroke()

    ctx.beginPath()
    ctx.moveTo(points[3][0], points[3][1])
    ctx.lineTo(points[0][0], points[0][1])
    ctx.stroke()

  } else if (currentHighlight.value === 'angles') {
    // –í–∏–¥—ñ–ª—è—î–º–æ –≤—Å—ñ –ø—Ä—è–º—ñ –∫—É—Ç–∏
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 3
    const corner = 12

    ctx.strokeRect(points[0][0], points[0][1], corner, corner)
    ctx.strokeRect(points[1][0] - corner, points[1][1], corner, corner)
    ctx.strokeRect(points[2][0] - corner, points[2][1] - corner, corner, corner)
    ctx.strokeRect(points[3][0], points[3][1] - corner, corner, corner)

    // –ü—ñ–¥–ø–∏—Å–∏ –∫—É—Ç—ñ–≤
    ctx.fillStyle = '#dc2626'
    ctx.font = '12px Arial'
    ctx.fillText('90¬∞', points[0][0] + 15, points[0][1] + 15)
    ctx.fillText('90¬∞', points[1][0] - 25, points[1][1] + 15)
    ctx.fillText('90¬∞', points[2][0] - 25, points[2][1] - 5)
    ctx.fillText('90¬∞', points[3][0] + 15, points[3][1] - 5)

  } else if (currentHighlight.value === 'diagonals') {
    // –î—ñ–∞–≥–æ–Ω–∞–ª—ñ
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 3

    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[2][0], points[2][1])
    ctx.stroke()

    ctx.beginPath()
    ctx.moveTo(points[1][0], points[1][1])
    ctx.lineTo(points[3][0], points[3][1])
    ctx.stroke()

    // –¢–æ—á–∫–∞ –ø–µ—Ä–µ—Ç–∏–Ω—É
    const centerX = (points[0][0] + points[2][0]) / 2
    const centerY = (points[0][1] + points[2][1]) / 2

    ctx.fillStyle = '#dc2626'
    ctx.beginPath()
    ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI)
    ctx.fill()

    ctx.fillStyle = '#1f2937'
    ctx.font = '12px Arial'
    ctx.fillText('O', centerX + 8, centerY - 8)

    // –ü—ñ–¥–ø–∏—Å–∏ –¥–æ–≤–∂–∏–Ω
    ctx.fillStyle = '#dc2626'
    ctx.fillText('AC = BD', centerX + 15, centerY + 15)

  } else if (currentHighlight.value === 'center') {
    // –¶–µ–Ω—Ç—Ä —Ç–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ –¥–æ –≤–µ—Ä—à–∏–Ω
    const centerX = (points[0][0] + points[2][0]) / 2
    const centerY = (points[0][1] + points[2][1]) / 2

    // –î—ñ–∞–≥–æ–Ω–∞–ª—ñ –ø—É–Ω–∫—Ç–∏—Ä–æ–º
    ctx.strokeStyle = '#94a3b8'
    ctx.lineWidth = 1
    ctx.setLineDash([5, 5])

    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[2][0], points[2][1])
    ctx.stroke()

    ctx.beginPath()
    ctx.moveTo(points[1][0], points[1][1])
    ctx.lineTo(points[3][0], points[3][1])
    ctx.stroke()

    ctx.setLineDash([])

    // –í—ñ–¥—Å—Ç–∞–Ω—ñ –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É –¥–æ –≤–µ—Ä—à–∏–Ω
    ctx.strokeStyle = '#dc2626'
    ctx.lineWidth = 2

    points.forEach(point => {
      ctx.beginPath()
      ctx.moveTo(centerX, centerY)
      ctx.lineTo(point[0], point[1])
      ctx.stroke()
    })

    // –¶–µ–Ω—Ç—Ä
    ctx.fillStyle = '#dc2626'
    ctx.beginPath()
    ctx.arc(centerX, centerY, 5, 0, 2 * Math.PI)
    ctx.fill()

    ctx.fillStyle = '#1f2937'
    ctx.font = '12px Arial'
    ctx.fillText('O', centerX + 8, centerY - 8)
  }
}

function drawParallelogram(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)
  ctx.strokeStyle = '#7c3aed'
  ctx.fillStyle = 'rgba(124, 58, 237, 0.1)'
  ctx.lineWidth = 2

  const centerX = width / 2
  const centerY = height / 2
  const w = 60
  const h = 40
  const skew = 15

  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–µ—Ä—à–∏–Ω –ø–∞—Ä–∞–ª–µ–ª–æ–≥—Ä–∞–º–∞
  const points = [
    [centerX - w/2 - skew/2, centerY - h/2],
    [centerX + w/2 - skew/2, centerY - h/2],
    [centerX + w/2 + skew/2, centerY + h/2],
    [centerX - w/2 + skew/2, centerY + h/2]
  ]

  ctx.beginPath()
  ctx.moveTo(points[0][0], points[0][1])
  for (let i = 1; i < points.length; i++) {
    ctx.lineTo(points[i][0], points[i][1])
  }
  ctx.closePath()
  ctx.fill()
  ctx.stroke()
}

function drawSquare(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)
  ctx.strokeStyle = '#dc2626'
  ctx.fillStyle = 'rgba(220, 38, 38, 0.1)'
  ctx.lineWidth = 2

  const centerX = width / 2
  const centerY = height / 2
  const size = 50

  ctx.fillRect(centerX - size/2, centerY - size/2, size, size)
  ctx.strokeRect(centerX - size/2, centerY - size/2, size, size)

  // –ü–æ–∑–Ω–∞—á–∫–∏ –ø—Ä—è–º–∏—Ö –∫—É—Ç—ñ–≤
  const corner = 8
  ctx.strokeRect(centerX - size/2, centerY - size/2, corner, corner)
  ctx.strokeRect(centerX + size/2 - corner, centerY - size/2, corner, corner)
  ctx.strokeRect(centerX + size/2 - corner, centerY + size/2 - corner, corner, corner)
  ctx.strokeRect(centerX - size/2, centerY + size/2 - corner, corner, corner)

  // –ü–æ–∑–Ω–∞—á–∫–∏ —Ä—ñ–≤–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω
  ctx.strokeStyle = '#dc2626'
  ctx.lineWidth = 1
  const markSize = 3

  // –í–µ—Ä—Ö–Ω—è —Å—Ç–æ—Ä–æ–Ω–∞
  ctx.beginPath()
  ctx.moveTo(centerX - markSize, centerY - size/2 - 5)
  ctx.lineTo(centerX + markSize, centerY - size/2 - 5)
  ctx.stroke()

  // –ü—Ä–∞–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞
  ctx.beginPath()
  ctx.moveTo(centerX + size/2 + 5, centerY - markSize)
  ctx.lineTo(centerX + size/2 + 5, centerY + markSize)
  ctx.stroke()

  // –ù–∏–∂–Ω—è —Å—Ç–æ—Ä–æ–Ω–∞
  ctx.beginPath()
  ctx.moveTo(centerX - markSize, centerY + size/2 + 5)
  ctx.lineTo(centerX + markSize, centerY + size/2 + 5)
  ctx.stroke()

  // –õ—ñ–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞
  ctx.beginPath()
  ctx.moveTo(centerX - size/2 - 5, centerY - markSize)
  ctx.lineTo(centerX - size/2 - 5, centerY + markSize)
  ctx.stroke()
}

function drawInscribedCircle(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const centerX = width / 2
  const centerY = height / 2
  const size = 80

  // –ö–≤–∞–¥—Ä–∞—Ç
  ctx.strokeStyle = '#2563eb'
  ctx.fillStyle = 'rgba(37, 99, 235, 0.1)'
  ctx.lineWidth = 2
  ctx.fillRect(centerX - size/2, centerY - size/2, size, size)
  ctx.strokeRect(centerX - size/2, centerY - size/2, size, size)

  // –í–ø–∏—Å–∞–Ω–µ –∫–æ–ª–æ
  ctx.strokeStyle = '#dc2626'
  ctx.fillStyle = 'rgba(220, 38, 38, 0.1)'
  ctx.beginPath()
  ctx.arc(centerX, centerY, size/2, 0, 2 * Math.PI)
  ctx.fill()
  ctx.stroke()

  // –ü—ñ–¥–ø–∏—Å
  ctx.fillStyle = '#1f2937'
  ctx.font = '12px Arial'
  ctx.fillText('–ö–æ–ª–æ –º–æ–∂–Ω–∞ –≤–ø–∏—Å–∞—Ç–∏', centerX - 50, centerY + size/2 + 20)
  ctx.fillText('—Ç—ñ–ª—å–∫–∏ –≤ –∫–≤–∞–¥—Ä–∞—Ç!', centerX - 40, centerY + size/2 + 35)
}

function drawMedian(canvas) {
  const ctx = canvas.getContext('2d')
  const { width, height } = canvas

  ctx.clearRect(0, 0, width, height)

  const centerX = width / 2
  const centerY = height / 2
  const w = 100
  const h = 70

  // –ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫
  const points = [
    [centerX - w/2, centerY + h/2], // A (–ø—Ä—è–º–∏–π –∫—É—Ç)
    [centerX + w/2, centerY + h/2], // B
    [centerX - w/2, centerY - h/2]  // C
  ]

  ctx.strokeStyle = '#2563eb'
  ctx.fillStyle = 'rgba(37, 99, 235, 0.1)'
  ctx.lineWidth = 2

  ctx.beginPath()
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[1][0], points[1][1])
  ctx.lineTo(points[2][0], points[2][1])
  ctx.closePath()
  ctx.fill()
  ctx.stroke()

  // –ü–æ–∑–Ω–∞—á–∫–∞ –ø—Ä—è–º–æ–≥–æ –∫—É—Ç–∞
  const corner = 10
  ctx.strokeRect(points[0][0], points[0][1] - corner, corner, corner)

  // –ú–µ–¥—ñ–∞–Ω–∞ –¥–æ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑–∏
  const midX = (points[1][0] + points[2][0]) / 2
  const midY = (points[1][1] + points[2][1]) / 2

  ctx.strokeStyle = '#dc2626'
  ctx.lineWidth = 3
  ctx.setLineDash([])
  ctx.beginPath()
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(midX, midY)
  ctx.stroke()

  // –ü–æ–∑–Ω–∞—á–∫–∏ —Ä—ñ–≤–Ω–∏—Ö –≤—ñ–¥—Ä—ñ–∑–∫—ñ–≤ –≥—ñ–ø–æ—Ç–µ–Ω—É–∑–∏
  ctx.strokeStyle = '#16a34a'
  ctx.lineWidth = 2

  // –ü–µ—Ä—à–∞ –ø–æ–ª–æ–≤–∏–Ω–∞
  ctx.beginPath()
  ctx.arc((points[1][0] + midX) / 2, (points[1][1] + midY) / 2, 3, 0, 2 * Math.PI)
  ctx.fill()

  // –î—Ä—É–≥–∞ –ø–æ–ª–æ–≤–∏–Ω–∞
  ctx.beginPath()
  ctx.arc((points[2][0] + midX) / 2, (points[2][1] + midY) / 2, 3, 0, 2 * Math.PI)
  ctx.fill()

  // –ü—ñ–¥–ø–∏—Å–∏
  ctx.fillStyle = '#1f2937'
  ctx.font = '12px Arial'
  ctx.fillText('A', points[0][0] - 15, points[0][1] + 15)
  ctx.fillText('B', points[1][0] + 5, points[1][1] + 15)
  ctx.fillText('C', points[2][0] - 15, points[2][1] - 5)
  ctx.fillText('M', midX + 5, midY - 5)

  ctx.fillStyle = '#dc2626'
  ctx.fillText('m', points[0][0] - 20, (points[0][1] + midY) / 2)
  ctx.fillText('c/2', midX + 10, midY + 15)
}

function highlightProperty(property) {
  currentHighlight.value = property
  drawRectangleWithProperties(propertiesCanvas.value)
}

onMounted(async () => {
  await nextTick()

  if (definitionCanvas.value) {
    drawRectangle(definitionCanvas.value, { showRightAngles: true })
  }

  if (propertiesCanvas.value) {
    drawRectangleWithProperties(propertiesCanvas.value)
  }

  if (parallelogramCanvas.value) {
    drawParallelogram(parallelogramCanvas.value)
  }

  if (rectangleCanvas.value) {
    drawRectangle(rectangleCanvas.value, {
      width: 60,
      height: 40,
      showRightAngles: true,
      hideLabels: true
    })
  }

  if (squareCanvas.value) {
    drawSquare(squareCanvas.value)
  }

  if (inscribedCircleCanvas.value) {
    drawInscribedCircle(inscribedCircleCanvas.value)
  }

  if (medianCanvas.value) {
    drawMedian(medianCanvas.value)
  }
})
</script>

<style scoped>
.rectangle-lesson {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  min-height: 100vh;
}

.lesson-content {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.content-section {
  background: white;
  padding: 2rem;
  border-radius: 15px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.08);
  border: 1px solid #e2e8f0;
}

.content-section h2 {
  color: #1e293b;
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  border-bottom: 3px solid #3b82f6;
  padding-bottom: 0.5rem;
}

.definition-box {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 2rem;
  align-items: center;
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 10px;
  border-left: 5px solid #3b82f6;
}

.definition-box p {
  font-size: 1.1rem;
  margin: 0;
  color: #334155;
}

.rectangle-visual {
  display: flex;
  justify-content: center;
  align-items: center;
}

.intro-text {
  color: #475569;
  margin-bottom: 1.5rem;
  font-size: 1.1rem;
}

.properties-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.property-card {
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 12px;
  border: 2px solid transparent;
  cursor: pointer;
  transition: all 0.3s ease;
}

.property-card:hover {
  border-color: #3b82f6;
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15);
}

.property-card h3 {
  color: #1e293b;
  margin: 0 0 1rem 0;
  font-size: 1.2rem;
}

.property-card p {
  color: #475569;
  margin: 0 0 0.5rem 0;
}

.formula {
  background: #e0f2fe;
  padding: 0.5rem;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-weight: bold;
  color: #0369a1;
  margin: 0.25rem 0;
}

.interactive-rectangle {
  text-align: center;
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 10px;
  border: 2px dashed #cbd5e1;
}

.hint {
  color: #64748b;
  font-style: italic;
  margin: 1rem 0 0 0;
}

.signs-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.sign-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  background: #f8fafc;
  padding: 1rem;
  border-radius: 10px;
  border-left: 4px solid #10b981;
}

.sign-number {
  font-size: 1.5rem;
  min-width: 40px;
}

.sign-content p {
  margin: 0;
  color: #334155;
}

.relationship-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.relationship-card {
  text-align: center;
  background: #f8fafc;
  padding: 1.5rem;
  border-radius: 12px;
  border: 2px solid #e2e8f0;
  transition: all 0.3s ease;
}

.relationship-card.highlight {
  border-color: #3b82f6;
  background: #eff6ff;
  transform: scale(1.05);
}

.relationship-card:hover {
  border-color: #3b82f6;
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.relationship-card h3 {
  color: #1e293b;
  margin: 0 0 0.5rem 0;
}

.relationship-card p {
  color: #64748b;
  margin: 0 0 1rem 0;
  font-size: 0.9rem;
}

.special-property {
  background: #fffbeb;
  padding: 1.5rem;
  border-radius: 10px;
  border-left: 5px solid #f59e0b;
  text-align: center;
}

.special-property h3 {
  color: #92400e;
  margin: 0 0 1rem 0;
}

.special-property p {
  color: #78350f;
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
}

.median-explanation {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 2rem;
  align-items: center;
}

.median-explanation p {
  color: #334155;
  font-size: 1.1rem;
  margin: 0 0 1rem 0;
}

.formula-box {
  background: #f0f9ff;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #0ea5e9;
}

.formula-box .formula {
  font-size: 1.2rem;
  margin: 0 0 0.5rem 0;
}

.formula-box p {
  margin: 0;
  font-size: 0.9rem;
  color: #0369a1;
}

.summary {
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
  border: 2px solid #10b981;
}

.summary h2 {
  color: #047857;
  border-bottom-color: #10b981;
}

.summary-box {
  background: white;
  padding: 1.5rem;
  border-radius: 10px;
  border: 1px solid #a7f3d0;
}

.summary-box p {
  color: #047857;
  font-weight: bold;
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
}

.summary-box ul {
  color: #065f46;
  margin: 0;
  padding-left: 1.5rem;
}

.summary-box li {
  margin: 0.5rem 0;
  font-weight: 500;
}

canvas {
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  background: white;
}

@media (max-width: 768px) {
  .rectangle-lesson {
    padding: 1rem;
  }

  .definition-box,
  .median-explanation {
    grid-template-columns: 1fr;
    text-align: center;
  }

  .properties-grid {
    grid-template-columns: 1fr;
  }

  .relationship-grid {
    grid-template-columns: 1fr;
  }
}
</style>